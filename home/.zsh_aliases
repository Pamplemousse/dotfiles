# general
alias edit="vim"
alias lla="ls -alh"
alias duh="du -h . | grep '\./[^/]*$'"
alias myip="/sbin/ifconfig | grep 'inet ' | awk '{ print $2}'"
alias myssh="echo -n `cat ~/.ssh/id_rsa.pub` | xclip -selection clipboard"

alias sshc="edit ~/.ssh/conf.d"
alias gemc="edit ~/.gemrc"
alias vimc="vim -p $HOME/.vimrc $HOME/.vimrc.plugins $HOME/.vimrc.bepo"

alias burp="java -Djava.awt.headless=false -Xmx1024m -XX:MaxPermSize=1G -jar ~/Workspace/tools/burp.jar"
alias internet\?="ping 8.8.8.8"


# zsh
alias npm="nocorrect npm"
alias grunt="nocorrect grunt"
alias guard="nocorrect guard"
alias rspec="nocorrect rspec"
alias guard="guard --no-bundler-warning"
alias reload="echo \`pwd\` > $HOME/.RELOAD && source ~/.zshrc"

alias zshc="edit $HOME/.zshrc"
alias zsha="edit $HOME/.zsh_aliases"


# ruby / rails
alias pry="docker run --rm -it pamplemousse/ruby"
alias rdbc="rake db:create"
alias rdbm="rake db:migrate"
alias rdbtp="rake db:test:prepare"
alias rdbs="rake db:seed"
alias dbreset="rdbd && rdbc && rdbm && rdbtp"


# docker
alias dps="docker ps -a"
alias drm="docker rm"
alias dstop="docker stop"
alias dlg="docker logs"
alias drmi="docker rmi"


# ansible
ansible_image="pamplemousse/ansible"

alias ansible="\
  docker run \
    --name ansible \
    --rm \
    ${ansible_image} \
    ansible"

alias ansible-playbook="\
  docker run \
    --name ansible-playbook \
    -it --rm \
    --volume $(pwd):/home/ansible/project \
    -w /home/ansible/project \
    --volume $SSH_AUTH_SOCK:/ssh-agent --env SSH_AUTH_SOCK=/ssh-agent \
    --volume ${HOME}/.ssh/config:/home/ansible/.ssh/config:ro \
    --volume ${HOME}/.ssh/known_hosts:/home/ansible/.ssh/known_hosts:ro \
    ${ansible_image} \
    ansible-playbook"

alias ansible-galaxy="\
  docker run \
    --name ansible-galaxy \
    --rm \
    --volume $(pwd):/home/ansible/project \
    -w /home/ansible/project \
    ${ansible_image} \
    ansible-galaxy"


# git
alias gst="git status -s"
alias gll="git log --pretty=format:'%C(yellow)%h %C(cyan)%ad %C(reset)%s %C(green)[%cn]' --decorate --date=short --graph"
alias gd="git diff --ignore-space-at-eol -b -w --ignore-blank-lines"
alias gds="git diff --staged"
alias gap="git add -p"
alias gcamend="gca --amend"
alias gitc="edit $HOME/.gitconfig"

function gpl () {
  git pull origin $(git rev-parse --abbrev-ref HEAD)
}


# misc

# Custom search
search () {
  for i in "$@"; do
    ( find -iname "*$i*" | grep -i "$i" --color=auto ) 2> /dev/null;
  done
}

# Completion on ssh config's hosts
h=()
if [[ -r ~/.ssh/config ]]; then
  h=($h ${${${(@M)${(f)"$(cat ~/.ssh/config)"}:#Host *}#Host }:#*[*?]*})
fi
# if [[ -r ~/.ssh/known_hosts ]]; then
#   h=($h ${${${(f)"$(cat ~/.ssh/known_hosts{,2} || true)"}%%\ *}%%,*}) 2>/dev/null
# fi
if [[ $#h -gt 0 ]]; then
  zstyle ':completion:*:ssh:*' hosts $h
  zstyle ':completion:*:slogin:*' hosts $h
fi

function ok() {
  if [ -z "$1" ]; then
    echo -e "\033[32mOK\033[0m"
  else
    echo -e "\033[32m$1\033[0m"
  fi
}

function not_ok() {
  if [ -z "$1" ]; then
    echo -e "\033[31mNOT OK\033[0m"
  else
    echo -e "\033[31m$1\033[0m"
  fi
}

function save () {
  sed -i.bak '' "$@"
}
